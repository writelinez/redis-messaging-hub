var RedisMessageHub=function(e){function t(e,t,n,a,i){var o={Id:e,Type:t,Channel:n,Data:a,Date:i||new Date};this.id=o.Id,this.type=o.Type,this.channel=o.Channel,this.data=o.Data,this.date=o.Date,this.toString=function(){return o.Id=this.id,o.Type=this.type,o.Channel=this.channel,o.Data=this.data,o.Date=this.date,JSON.stringify(o)}}function n(e,t){this.type=e,this.value=t,this.toString=function(){return this.type+this.value}}function a(){}function i(){}var o=void 0,r=void 0,S=void 0,s=void 0,c=void 0,d=void 0,E=void 0,u=void 0,N=void 0,C=null,h=null,f=null,l=null;return function(){var t="ws://";if(!e||!e.url)throw new n("Argument Exception","RedisMessageHub requires options in the constructor. url is required.");e.useSsl&&(t="wss://"),r=t+e.url}(),C=function(e){if(o.readyState==WebSocket.OPEN){if(S){var n=new t(0,a.AUTHENTICATE,"",S).toString();o.readyState==WebSocket.OPEN&&o.send(n)}s&&s()}},h=function(e){if(o.readyState==WebSocket.OPEN){var n=t.fromString(e.data);switch(n.type){case a.PING_PONG:n.data="PONG",n.date=new Date,o.readyState==WebSocket.OPEN&&o.send(n.toString());break;case a.MESSAGE:c&&c(n);break;case a.SUBSCRIBE_CONFIRM:u&&u(n);break;case a.UNSUBSCRIBE_CONFIRM:N&&N(n)}}},f=function(e){E&&E(e)},l=function(e){d&&d(e)},t.fromString=function(e){var n=JSON.parse(e);return new t(n.Id,n.Type,n.Channel,n.Data,n.Date)},a.PING_PONG=0,a.MESSAGE=1,a.SUBSCRIBE=2,a.UNSUBSCRIBE=3,a.AUTHENTICATE=4,a.SUBSCRIBE_CONFIRM=5,a.UNSUBSCRIBE_CONFIRM=6,a.INSTANCEID_REQUEST=7,i.DISCONNECTED=0,i.CONNECTED=1,{MESSAGE_TYPE:a,HUB_STATE:i,connect:function(e){e&&(S=e.authData,s=e.onConnected,c=e.onMessage,d=e.onError,E=e.onClosed,u=e.onChannelJoined,N=e.onChannelRetired),(o=new WebSocket(r)).onopen=C,o.onmessage=h,o.onclose=f,o.onerror=l},disconnect:function(){o&&(o.close(),o=void 0)},state:function(){return o&&o.readyState==WebSocket.OPEN?i.CONNECTED:i.DISCONNECTED},joinChannel:function(e){if(o&&o.readyState==WebSocket.OPEN&&e){var n=new t(0,a.SUBSCRIBE,e,"",new Date).toString();o.send(n)}},leaveChannel:function(e){if(o&&o.readyState==WebSocket.OPEN&&e){var n=new t(0,a.UNSUBSCRIBE,e,"",new Date).toString();o.send(n)}},sendMessage:function(e,n){if(o&&o.readyState==WebSocket.OPEN&&e){var i=new t(0,a.MESSAGE,e,n,new Date).toString();o.send(i)}}}};